<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mariana Trench Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mariana Trench Blog Atom Feed"><title data-react-helmet="true">Configuration | Mariana Trench</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Configuration | Mariana Trench"><meta data-react-helmet="true" name="description" content="Mariana Trench is highly configurable and we recommend that you invest time into adjusting the tool to your specific use cases. At Facebook, we have dedicated security engineers that will spend a significant amount of their time adding new rules and model generators to improve the analysis results."><meta data-react-helmet="true" property="og:description" content="Mariana Trench is highly configurable and we recommend that you invest time into adjusting the tool to your specific use cases. At Facebook, we have dedicated security engineers that will spend a significant amount of their time adding new rules and model generators to improve the analysis results."><meta data-react-helmet="true" property="og:url" content="https://mariana-tren.ch/docs/configuration"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://mariana-tren.ch/docs/configuration"><link rel="stylesheet" href="/styles.de22d33a.css">
<link rel="preload" href="/styles.287d2076.js" as="script">
<link rel="preload" href="/runtime~main.e91be79e.js" as="script">
<link rel="preload" href="/main.cb7957ae.js" as="script">
<link rel="preload" href="/common.06b42eb1.js" as="script">
<link rel="preload" href="/2.38aa3b5f.js" as="script">
<link rel="preload" href="/1be78505.491426a5.js" as="script">
<link rel="preload" href="/26.587ae094.js" as="script">
<link rel="preload" href="/935f2afb.0e593713.js" as="script">
<link rel="preload" href="/17896441.7410b4d5.js" as="script">
<link rel="preload" href="/dc74e05e.edf951c8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><strong class="navbar__title">Mariana Trench</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/overview">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/mariana-trench" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">Mariana Trench</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/overview">Documentation</a></li><li class="menu__list-item"><a href="https://github.com/facebook/mariana-trench" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">User Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/customize-sources-and-sinks">Customize Sources and Sinks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/models">Models</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/configuration">Configuration</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contribution">Contribution</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Configuration</h1></header><div class="markdown"><p>Mariana Trench is highly configurable and we recommend that you invest time into adjusting the tool to your specific use cases. At Facebook, we have dedicated security engineers that will spend a significant amount of their time adding new rules and model generators to improve the analysis results.</p><p>This page will cover the more important, non-trivial configuration options. Note that you will spend most of your time configuring Mariana Trench writing model generators. These are covered in the <a href="/docs/models">next section</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="command-line-options"></a>Command Line Options<a class="hash-link" href="#command-line-options" title="Direct link to heading">#</a></h2><p>You can get a full set of options by running <code>mariana-trench --help</code>. The following is an abbreviated version of the output.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-shell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ mariana-trench --help</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Target arguments:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --apk-path APK_PATH   The APK to analyze.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Output arguments:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --output-directory OUTPUT_DIRECTORY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        The directory to store results in.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Configuration arguments:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --system-jar-configuration-path SYSTEM_JAR_CONFIGURATION_PATH</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        A JSON configuration </span><span class="token function" style="color:rgb(130, 170, 255)">file</span><span class="token plain"> with a list of paths to the system jars.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --rules-paths RULES_PATHS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        A </span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token plain">-separated list of rules files and directories containing rules files.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --repository-root-directory REPOSITORY_ROOT_DIRECTORY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        The root of the repository. Resulting paths will be relative to this.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --source-root-directory SOURCE_ROOT_DIRECTORY</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        The root where </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">source</span><span class="token plain"> files </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> the APK can be found.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --model-generator-configuration-paths MODEL_GENERATOR_CONFIGURATION_PATHS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        A </span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token plain">-separated list of paths specifying JSON configuration files. Each </span><span class="token function" style="color:rgb(130, 170, 255)">file</span><span class="token plain"> is a list of paths to JSON model generators relative to the</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        configuration </span><span class="token function" style="color:rgb(130, 170, 255)">file</span><span class="token plain"> or names of CPP model generators.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --model-generator-search-paths MODEL_GENERATOR_SEARCH_PATHS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        A </span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token plain">-separated list of paths where we </span><span class="token function" style="color:rgb(130, 170, 255)">look</span><span class="token plain"> up JSON model generators.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --maximum-source-sink-distance MAXIMUM_SOURCE_SINK_DISTANCE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        Limits the distance of sources and sinks from a trace entry point.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="--apk-path"></a><code>--apk-path</code><a class="hash-link" href="#--apk-path" title="Direct link to heading">#</a></h4><p>Mariana Trench analyzes Dalvik bytecode. You provide it with the android app (APK) to analyze.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="--output-directory-output_directory"></a><code>--output-directory OUTPUT_DIRECTORY</code><a class="hash-link" href="#--output-directory-output_directory" title="Direct link to heading">#</a></h4><p>The output of the analysis is a file containing metadata about the particular run in JSON format as well as sharded files containing data flow specifications for every method in the APK. These files need to be processed by SAPP (see <a href="/docs/getting-started">Getting Started</a>) after the analysis. The flag specifies where these files are saved.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="--system-jar-configuration-path-system_jar_configuration_path"></a><code>--system-jar-configuration-path SYSTEM_JAR_CONFIGURATION_PATH</code><a class="hash-link" href="#--system-jar-configuration-path-system_jar_configuration_path" title="Direct link to heading">#</a></h4><p>This path points to a json file containing a list of <code>.jar</code> files that the analysis should include in the analysis. It&#x27;s important that this contains at least the <code>android.jar</code> on your system. This file is typically located in your android SDK distribution at <code>$ANDROID_SDK/platforms/android-30/android.jar</code>. Without the <code>android.jar</code>, Mariana Trench will not know about many methods from the standard library that might be important for your model generators.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="--rules-paths-rules_paths"></a><code>--rules-paths RULES_PATHS</code><a class="hash-link" href="#--rules-paths-rules_paths" title="Direct link to heading">#</a></h4><p>A <code>;</code> separated search path pointing to files and directories containing rules files. These files specify what taint flows Mariana Trench should look for. Check out the <a href="https://github.com/facebook/mariana-trench/blob/main/configuration/rules.json#L2-L13" target="_blank" rel="noopener noreferrer"><code>rules.json</code></a> that&#x27;s provided by default. It specifies that we want to find flows from user controlled input (<code>ActivityUserInput</code>) into <code>CodeExecution</code> sinks and that this constitutes a remote code execution.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="--source-root-directory-source_root_directory"></a><code>--source-root-directory SOURCE_ROOT_DIRECTORY</code><a class="hash-link" href="#--source-root-directory-source_root_directory" title="Direct link to heading">#</a></h4><p>Mariana Trench will do a source indexing path before the analysis. This is because Dalvik/Java bytecode does not contain complete location information, only filenames (not paths) and line numbers. The index is later used to emit precise locations.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="--model-generator-configuration-paths-model_generator_configuration_paths"></a><code>--model-generator-configuration-paths MODEL_GENERATOR_CONFIGURATION_PATHS</code><a class="hash-link" href="#--model-generator-configuration-paths-model_generator_configuration_paths" title="Direct link to heading">#</a></h4><p>A <code>;</code> separated set of files containing the names of model generators to run. See <a href="https://github.com/facebook/mariana-trench/blob/main/configuration/default_generator_config.json" target="_blank" rel="noopener noreferrer"><code>default_generator_config.json</code></a> for an example.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="--model-generator-search-paths-model_generator_search_paths"></a><code>--model-generator-search-paths MODEL_GENERATOR_SEARCH_PATHS</code><a class="hash-link" href="#--model-generator-search-paths-model_generator_search_paths" title="Direct link to heading">#</a></h4><p>A <code>;</code> separated search path where Mariana Trench will try to find the model generators specified in the generator configuration.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="--maximum-source-sink-distance-maximum_source_sink_distance"></a><code>--maximum-source-sink-distance MAXIMUM_SOURCE_SINK_DISTANCE</code><a class="hash-link" href="#--maximum-source-sink-distance-maximum_source_sink_distance" title="Direct link to heading">#</a></h4><p>For performance reasons it can be useful to limit the maximum length of a trace Mariana Trench tries to find (note that longer traces also tend to be harder to interpret). Due to the modular nature of the analysis the value specified here limits the maximum length from the trace root to the source, and from the trace root to the sink. This means found traces can have length of <code>2 x MAXIMUM_SOURCE_SINK_DISTANCE</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/mariana-trench/tree/main/documentation/website/documentation/configuration.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/models"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Models</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/contribution"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Contribution »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#command-line-options" class="table-of-contents__link">Command Line Options</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/fbOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/mariana-trench" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_31Aa"><img class="footer__logo" alt="Facebook Open Source Logo" src="/img/oss_logo.png"></a></div><div class="footer__copyright">Copyright © 2021 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.287d2076.js"></script>
<script src="/runtime~main.e91be79e.js"></script>
<script src="/main.cb7957ae.js"></script>
<script src="/common.06b42eb1.js"></script>
<script src="/2.38aa3b5f.js"></script>
<script src="/1be78505.491426a5.js"></script>
<script src="/26.587ae094.js"></script>
<script src="/935f2afb.0e593713.js"></script>
<script src="/17896441.7410b4d5.js"></script>
<script src="/dc74e05e.edf951c8.js"></script>
</body>
</html>